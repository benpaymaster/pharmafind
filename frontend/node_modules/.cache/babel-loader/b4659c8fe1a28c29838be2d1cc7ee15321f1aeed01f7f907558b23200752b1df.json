{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{MapContainer,TileLayer,Marker,Popup}from\"react-leaflet\";import\"leaflet/dist/leaflet.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CARDIFF_CENTER=[51.4816,-3.1791];const RADIUS_KM=2;function haversineDistance(lat1,lon1,lat2,lon2){function toRad(x){return x*Math.PI/180;}const R=6371;// km\nconst dLat=toRad(lat2-lat1);const dLon=toRad(lon2-lon1);const a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)*Math.sin(dLon/2);const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return R*c;}const PharmacyMap=()=>{const[pharmacies,setPharmacies]=useState([]);const[userLocation,setUserLocation]=useState(\"\");const[center,setCenter]=useState(CARDIFF_CENTER);const[filteredPharmacies,setFilteredPharmacies]=useState([]);useEffect(()=>{fetch(\"/src/data/cardiff_pharmacies.json\").then(res=>res.json()).then(data=>setPharmacies(data));},[]);useEffect(()=>{if(center&&pharmacies.length>0){const filtered=pharmacies.filter(pharmacy=>{const dist=haversineDistance(center[0],center[1],pharmacy.latitude,pharmacy.longitude);return dist<=RADIUS_KM;});setFilteredPharmacies(filtered);}},[center,pharmacies]);const handleLocationSearch=async e=>{e.preventDefault();if(!userLocation)return;// Geocode using Nominatim\nconst url=\"https://nominatim.openstreetmap.org/search?format=json&q=\".concat(encodeURIComponent(userLocation+', Cardiff'));const res=await fetch(url);const data=await res.json();if(data&&data.length>0){setCenter([parseFloat(data[0].lat),parseFloat(data[0].lon)]);}else{alert(\"Location not found\");}};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleLocationSearch,style:{marginBottom:\"1em\"},children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Enter your location (address or postcode):\",/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:userLocation,onChange:e=>setUserLocation(e.target.value),style:{marginLeft:\"1em\"}})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",style:{marginLeft:\"1em\"},children:\"Search\"})]}),/*#__PURE__*/_jsxs(MapContainer,{center:center,zoom:13,style:{height:\"500px\",width:\"100%\"},children:[/*#__PURE__*/_jsx(TileLayer,{attribution:\"\\xA9 <a href=\\\"https://www.openstreetmap.org/copyright\\\">OpenStreetMap</a> contributors\",url:\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"}),filteredPharmacies.map((pharmacy,idx)=>/*#__PURE__*/_jsx(Marker,{position:[pharmacy.latitude,pharmacy.longitude],children:/*#__PURE__*/_jsxs(Popup,{children:[/*#__PURE__*/_jsx(\"strong\",{children:pharmacy.name}),/*#__PURE__*/_jsx(\"br\",{}),pharmacy.address]})},idx))]}),/*#__PURE__*/_jsxs(\"p\",{children:[filteredPharmacies.length,\" pharmacies found within \",RADIUS_KM,\"km.\"]})]});};export default PharmacyMap;","map":{"version":3,"names":["React","useEffect","useState","MapContainer","TileLayer","Marker","Popup","jsx","_jsx","jsxs","_jsxs","CARDIFF_CENTER","RADIUS_KM","haversineDistance","lat1","lon1","lat2","lon2","toRad","x","Math","PI","R","dLat","dLon","a","sin","cos","c","atan2","sqrt","PharmacyMap","pharmacies","setPharmacies","userLocation","setUserLocation","center","setCenter","filteredPharmacies","setFilteredPharmacies","fetch","then","res","json","data","length","filtered","filter","pharmacy","dist","latitude","longitude","handleLocationSearch","e","preventDefault","url","concat","encodeURIComponent","parseFloat","lat","lon","alert","children","onSubmit","style","marginBottom","type","value","onChange","target","marginLeft","zoom","height","width","attribution","map","idx","position","name","address"],"sources":["/home/benpaymaster/pharma-ai-web3/frontend/src/components/PharmacyMap.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { MapContainer, TileLayer, Marker, Popup } from \"react-leaflet\";\nimport \"leaflet/dist/leaflet.css\";\n\nconst CARDIFF_CENTER = [51.4816, -3.1791];\nconst RADIUS_KM = 2;\n\n\nfunction haversineDistance(lat1, lon1, lat2, lon2) {\n  function toRad(x) { return x * Math.PI / 180; }\n  const R = 6371; // km\n  const dLat = toRad(lat2 - lat1);\n  const dLon = toRad(lon2 - lon1);\n  const a =\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *\n    Math.sin(dLon / 2) * Math.sin(dLon / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c;\n}\n\nconst PharmacyMap = () => {\n  const [pharmacies, setPharmacies] = useState([]);\n  const [userLocation, setUserLocation] = useState(\"\");\n  const [center, setCenter] = useState(CARDIFF_CENTER);\n  const [filteredPharmacies, setFilteredPharmacies] = useState([]);\n\n  useEffect(() => {\n    fetch(\"/src/data/cardiff_pharmacies.json\")\n      .then((res) => res.json())\n      .then((data) => setPharmacies(data));\n  }, []);\n\n  useEffect(() => {\n    if (center && pharmacies.length > 0) {\n      const filtered = pharmacies.filter(pharmacy => {\n        const dist = haversineDistance(center[0], center[1], pharmacy.latitude, pharmacy.longitude);\n        return dist <= RADIUS_KM;\n      });\n      setFilteredPharmacies(filtered);\n    }\n  }, [center, pharmacies]);\n\n  const handleLocationSearch = async (e) => {\n    e.preventDefault();\n    if (!userLocation) return;\n    // Geocode using Nominatim\n    const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(userLocation + ', Cardiff')}`;\n    const res = await fetch(url);\n    const data = await res.json();\n    if (data && data.length > 0) {\n      setCenter([parseFloat(data[0].lat), parseFloat(data[0].lon)]);\n    } else {\n      alert(\"Location not found\");\n    }\n  };\n\n  return (\n    <div>\n      <form onSubmit={handleLocationSearch} style={{ marginBottom: \"1em\" }}>\n        <label>\n          Enter your location (address or postcode):\n          <input\n            type=\"text\"\n            value={userLocation}\n            onChange={e => setUserLocation(e.target.value)}\n            style={{ marginLeft: \"1em\" }}\n          />\n        </label>\n        <button type=\"submit\" style={{ marginLeft: \"1em\" }}>Search</button>\n      </form>\n      <MapContainer center={center} zoom={13} style={{ height: \"500px\", width: \"100%\" }}>\n        <TileLayer\n          attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        />\n        {filteredPharmacies.map((pharmacy, idx) => (\n          <Marker key={idx} position={[pharmacy.latitude, pharmacy.longitude]}>\n            <Popup>\n              <strong>{pharmacy.name}</strong><br />\n              {pharmacy.address}\n            </Popup>\n          </Marker>\n        ))}\n      </MapContainer>\n      <p>{filteredPharmacies.length} pharmacies found within {RADIUS_KM}km.</p>\n    </div>\n  );\n};\n\nexport default PharmacyMap;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}